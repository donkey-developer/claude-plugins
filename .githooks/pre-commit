#!/usr/bin/env bash
set -euo pipefail

# Pre-commit hook: validate compiled files are in sync with prompt sources.
# If out of sync, the commit is rejected with instructions to regenerate.

REPO_ROOT="$(git rev-parse --show-toplevel)"
COMPILE_SCRIPT="${REPO_ROOT}/plugins/code-review/scripts/compile.sh"

# Only run if the compile script exists
if [[ ! -x "${COMPILE_SCRIPT}" ]]; then
    exit 0
fi

echo "Checking compiled files are in sync..."

if ! "${COMPILE_SCRIPT}" --check; then
    echo ""
    echo "Compiled files are out of sync with prompt sources."
    echo "Run the following command and commit the updated files:"
    echo ""
    echo "  ./plugins/code-review/scripts/compile.sh"
    echo ""
    exit 1
fi
